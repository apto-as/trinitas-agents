# workflow_moderate.yaml - 中程度タスク用ワークフローテンプレート

name: "Moderate Task Workflow"
description: "中程度の複雑さを持つタスクのための標準ワークフロー"
complexity: moderate
parallel_execution: true

steps:
  - id: analyze
    name: "要件分析"
    description: "詳細な要件分析とコンテキスト理解"
    default_persona: springfield
    tools:
      - Read
      - Grep
      - Sequential
    estimated_time: 15
    estimated_tokens: 2500
    
  - id: design
    name: "設計"
    description: "システム設計とアーキテクチャ定義"
    default_persona: springfield
    tools:
      - Sequential
      - Context7
    dependencies:
      - analyze
    estimated_time: 25
    estimated_tokens: 4000
    
  - id: implement
    name: "実装"
    description: "設計に基づく実装"
    default_persona: krukai
    tools:
      - Write
      - Edit
      - MultiEdit
    dependencies:
      - design
    estimated_time: 45
    estimated_tokens: 8000
    
  - id: test
    name: "テスト"
    description: "品質保証とテスト実行"
    default_persona: vector
    tools:
      - Playwright
      - Sequential
    dependencies:
      - implement
    estimated_time: 20
    estimated_tokens: 3000
    
  - id: document
    name: "文書化"
    description: "技術文書とユーザーガイドの作成"
    default_persona: springfield
    tools:
      - Write
      - Context7
    dependencies:
      - implement
    estimated_time: 15
    estimated_tokens: 2000
    parallel_with:
      - test

# 並列実行グループ
parallel_groups:
  - name: "テストと文書化"
    steps:
      - test
      - document
    condition: "domains_include_any(['testing', 'documentation'])"

# カスタマイズルール
customization_rules:
  - condition:
      domains: ["security"]
    modifications:
      test:
        description_append: "（セキュリティテストを重点的に実施）"
        time_multiplier: 1.4
        tools_add: ["Sequential"]
      design:
        tools_add: ["Sequential"]
        
  - condition:
      domains: ["performance"]
    modifications:
      test:
        description_append: "（パフォーマンステストを含む）"
        tools_add: ["Playwright"]
      implement:
        time_multiplier: 1.2
        
  - condition:
      domains: ["frontend", "backend"]
    modifications:
      design:
        description: "フルスタックアーキテクチャ設計"
        time_multiplier: 1.3

# 品質ゲート
quality_gates:
  - after_step: design
    checks:
      - design_review_completed: true
      - architecture_approved: true
      
  - after_step: test
    checks:
      - test_coverage: ">= 80"
      - critical_bugs: 0

# 成功基準
success_criteria:
  - all_steps_completed: true
  - quality_gates_passed: true
  - time_variance_percent: 25
  - parallel_efficiency: ">= 0.7"